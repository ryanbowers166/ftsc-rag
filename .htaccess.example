# FTSC RAG Search Tool - Apache Configuration
#
# Rename this file to '.htaccess' and place it in the same directory as index.php
# This is OPTIONAL but recommended for Apache servers
#
# NOTE: This requires Apache with mod_rewrite enabled
# If you're using Nginx or another web server, you'll need different configuration

# Enable rewrite engine
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Force HTTPS (recommended for security)
    # Uncomment the next 3 lines to force HTTPS
    # RewriteCond %{HTTPS} off
    # RewriteCond %{HTTP:X-Forwarded-Proto} !https
    # RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

    # Prevent access to config.php directly
    RewriteRule ^config\.php$ - [F,L]
</IfModule>

# Security headers
<IfModule mod_headers.c>
    # Prevent clickjacking
    Header always set X-Frame-Options "SAMEORIGIN"

    # Prevent MIME sniffing
    Header always set X-Content-Type-Options "nosniff"

    # Enable XSS protection
    Header always set X-XSS-Protection "1; mode=block"

    # Referrer policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # Content Security Policy (adjust as needed)
    # This allows markdown-it CDN and inline scripts
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:; connect-src 'self';"
</IfModule>

# Prevent directory listing
<IfModule mod_autoindex.c>
    Options -Indexes
</IfModule>

# Protect sensitive files
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# PHP security settings
<IfModule mod_php7.c>
    # Disable PHP execution in static directory
    php_flag engine off
</IfModule>

# File upload restrictions (if applicable)
<IfModule mod_php7.c>
    php_value upload_max_filesize 0
    php_value post_max_size 8M
</IfModule>

# Cache static assets (optional, for better performance)
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType text/css "access plus 1 week"
    ExpiresByType application/javascript "access plus 1 week"
</IfModule>

# Compression (optional, for better performance)
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript
</IfModule>

# Custom error pages (optional)
# ErrorDocument 404 /404.html
# ErrorDocument 500 /500.html

# Rate limiting (if mod_evasive is available)
# This is an additional layer on top of PHP rate limiting
<IfModule mod_evasive24.c>
    DOSHashTableSize 3097
    DOSPageCount 10
    DOSSiteCount 50
    DOSPageInterval 1
    DOSSiteInterval 1
    DOSBlockingPeriod 60
</IfModule>
